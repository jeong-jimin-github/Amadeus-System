<html>
<style>
    .button {
        background-color: #465183;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        font-family: 'Shippori Mincho B1', serif;
    }

    body {
        background-image: url('2133460020.jpg');
        background-repeat: no-repeat;
        background-size: cover;
    }
    a:link { color: rgb(116, 159, 240); text-decoration: none;}
    a:visited { color: rgb(116, 159, 240); text-decoration: none;}
    a:hover { color: rgb(116, 159, 240); text-decoration: underline;}
</style>

<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho+B1:wght@800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@800&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>
        AMADEUS
    </title>
</head>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<body>
    <a href='amadeus.html'><img src="제목을-입력해주세요.-001 (2).png" width="300" /></a>
    <center>
        <br><br>
        <img src="kurisu_normal1.png" width="200" /><br><br>
        <div id="q" style="color:white; font-family: 'Shippori Mincho B1', serif;">質問 : </div><br>
        <div id="a" style="color:white; font-family: 'Shippori Mincho B1', serif;">答え : </div>
        <br><input type="button" class="button" value="話す" onclick="new Audio('back_style_3_003.wav').play();speak()" /><br>
        <footer>
          <br>
          <a href='amadeus_kr.html' style="color:white; font-family: 'Nanum Myeongjo', serif;">한국어로도 이용하실 수 있습니다</a>
          <br>
          <p style="color:white; font-size: small; font-family: 'Shippori Mincho B1', serif;">Copyright © 2022 <a href="mailto: jmjeong10@Gmail.com" title="Contact">Jeong-Jimin</a> All rights reserved.</p>
          <p style="color:white; font-size: small; font-family: 'Shippori Mincho B1', serif;"><a href="https://github.com/jeong-jimin-github/Amadeus-System">Github Repository</a></p>
          <p style="color:white; font-size: small; font-family: 'Shippori Mincho B1', serif;"><a href="https://discord.gg/SXBeYcVyuM">Discord Server</a></p>
      </footer>
    </center>
</body>utterance
<script src="annyang.js"></script>
<script>
    if (annyang) {
        function speak() {
            annyang.start({ autoRestart: false, continuous: false });
            var recognition = annyang.getSpeechRecognizer();
            var final_transcript = '';
            recognition.interimResults = true;
            recognition.onresult = function(event) {
                var interim_transcript = '';
                final_transcript = '';
                for (var i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        final_transcript += event.results[i][0].transcript;
                        console.log("final_transcript=" + final_transcript);
                    } else {
                        interim_transcript += event.results[i][0].transcript;
                        console.log("interim_transcript=" + interim_transcript);
                    }
                }
                var getTagId = document.getElementById("q");
                document.getElementById("q").innerHTML = "質問 : " + final_transcript;
                if (final_transcript == '') {
                    return;
                }
                else {
                    var url = "https://thingproxy.freeboard.io/fetch/https://www.chaplus.jp/v1/chat?apikey=62aacf0a3d1a9";

                    var xhr = new XMLHttpRequest();
                    xhr.open("POST", url);

                    xhr.setRequestHeader("Content-Type", "application/json");

                    xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4) {
                        console.log(xhr.status);
                        console.log(JSON.parse(xhr.responseText).bestResponse.utterance);
                        new Audio("https://thingproxy.freeboard.io/fetch/https://api.su-shiki.com/v2/voicevox/audio/?text=" + JSON.parse(xhr.responseText).bestResponse.utterance + "&key=Q8D520187801Z06&speaker=2").play();
                        document.getElementById("a").innerHTML = "答え : " + JSON.parse(xhr.responseText).bestResponse.utterance;


                    }};

                    var data = '{"utterance":"' + final_transcript + '","username":"Okabe Rintarou","agentState":{"agentName":"Amadeus","tone":"normal", "age":"17歳"}}';

                    xhr.send(data);

                }
            };


        }
    }
</script>

</html>
